# comfyui-batch-ignore-node
# 批量忽略管理器 - 详细使用指南

## 安装方法

### 1. 文件放置
```
ComfyUI/custom_nodes/batch_ignore_manager/
├── __init__.py
├── batch_ignore_node.py
└── web/
    └── batch_ignore_manager.js
```

### 2. 重启ComfyUI
安装完成后重启ComfyUI，在节点菜单中会出现：
- `utils` → `批量忽略管理器`
- `utils` → `节点选择器`

---

## 核心概念

### 什么是"忽略"？
在ComfyUI中，忽略(Bypass)节点意味着：
- 节点不会被执行
- 输入直接传递到输出（如果有连接）
- 节点显示为灰色/暗色
- 可以临时跳过某些处理步骤

### 管理器的作用
批量忽略管理器可以同时控制多个节点的忽略状态，避免逐个手动设置。

---

## 基本使用方法

### 方法一：创建管理器节点

1. **添加节点**
   - 右键点击画布 → `Add Node` → `utils` → `批量忽略管理器`
   - 或者搜索 "BatchIgnoreManager"

2. **节点界面说明**
   ```
   ┌─────────────────────────────┐
   │    批量忽略管理器            │
   ├─────────────────────────────┤
   │ ignore_enabled: ☐ False     │  ← 主开关
   │ node_list: [               │  ← 节点列表
   │   "1",                     │
   │   "2",                     │
   │   "3"                      │
   │ ]                          │
   ├─────────────────────────────┤
   │ [添加选中节点]              │  ← 功能按钮
   │ [移除选中节点]              │
   │ [添加所有节点]              │
   │ [清空节点列表]              │
   └─────────────────────────────┘
   ```

### 方法二：使用右键菜单快速操作

选中要管理的节点 → 右键 → `批量忽略管理` → 选择操作

---

## 详细操作步骤

### 1. 添加节点到管理器

#### 方式A：使用按钮
1. **选中要管理的节点**
   - 按住 `Ctrl`/`Cmd` 点击多个节点选中
   - 或者拖拽选框选中多个节点

2. **添加到管理器**
   - 点击管理器节点上的 `[添加选中节点]` 按钮
   - 选中的节点ID会自动添加到 `node_list` 中

#### 方式B：使用右键菜单
1. 选中节点
2. 右键 → `批量忽略管理` → `添加选中节点到管理器`
3. 如果没有管理器，会自动创建一个

#### 方式C：手动输入
在 `node_list` 文本框中手动输入JSON格式：
```json
[
  "1",
  "5",
  "10",
  "15"
]
```

#### 方式D：一键添加所有节点
- 点击 `[添加所有节点]` 按钮
- 会添加工作流中的所有节点（除了管理器自己）

### 2. 控制忽略状态

#### 启用忽略
- 勾选 `ignore_enabled` 复选框
- 列表中的所有节点立即变为忽略状态（显示为灰色）

#### 禁用忽略
- 取消勾选 `ignore_enabled` 复选框  
- 列表中的所有节点恢复正常状态

### 3. 管理节点列表

#### 移除特定节点
1. 选中要移除的节点
2. 点击 `[移除选中节点]` 按钮
3. 被移除的节点会自动恢复正常状态

#### 清空所有节点
- 点击 `[清空节点列表]` 按钮
- 所有被管理的节点恢复正常状态
- 节点列表变为空

---

## 实际应用场景

### 场景1：调试工作流
```
问题：想要测试去掉某些后处理步骤的效果
解决：
1. 选中所有后处理节点
2. 添加到管理器
3. 勾选忽略开关测试
4. 取消勾选恢复处理
```

### 场景2：快速切换风格
```
问题：有两套不同的风格处理节点，想要快速切换
解决：
1. 创建两个管理器节点
2. 分别管理不同的风格节点组
3. 通过开关控制使用哪套风格
```

### 场景3：性能优化
```
问题：某些节点计算很慢，调试时想跳过
解决：
1. 将耗时节点添加到管理器
2. 调试时忽略这些节点
3. 最终输出时恢复
```

### 场景4：批量测试
```
问题：想要测试不同的节点组合效果
解决：
1. 按功能分组创建多个管理器
2. 通过不同的开关组合测试效果
3. 快速找到最佳配置
```

---

## 高级技巧

### 1. 多管理器协作
- 可以创建多个管理器管理不同的节点组
- 每个管理器独立控制自己的节点
- 适合复杂工作流的分层管理

### 2. 节点ID获取方法
- **查看节点标题**：节点右上角通常显示ID
- **控制台查看**：按F12，在Console中输入：
  ```javascript
  app.graph._nodes.forEach(n => console.log(`${n.title}: ${n.id}`))
  ```
- **使用选择器**：添加"节点选择器"节点辅助格式化

### 3. 状态监控
- 查看浏览器控制台(F12)获取详细操作日志
- 每次操作都会显示影响的节点数量
- 失败的操作会显示错误信息

### 4. 性能建议
- 大型工作流建议按功能分组管理
- 避免将所有节点都加入一个管理器
- 定期清理不需要的节点

---

## 常见问题解决

### Q: 节点没有被忽略
**A:** 检查以下几点：
- 确认节点ID是否正确
- 检查JSON格式是否正确
- 确认已勾选 `ignore_enabled`
- 查看控制台是否有错误信息

### Q: 按钮没有显示
**A:** 
- 重新创建管理器节点
- 检查插件是否正确安装
- 重启ComfyUI

### Q: 节点列表格式错误
**A:** 确保使用正确的JSON格式：
```json
// 正确 ✓
["1", "2", "3"]

// 错误 ✗
[1, 2, 3]
['1', '2', '3']
1,2,3
```

### Q: 无法添加选中节点
**A:**
- 确保已选中节点（节点边框高亮）
- 检查是否选中了管理器节点本身
- 尝试重新选择节点

---

## 键盘快捷键

配合ComfyUI原生快捷键使用：
- `Ctrl+A` / `Cmd+A`：全选节点
- `Ctrl+鼠标点击`：多选节点
- `拖拽选框`：框选多个节点
- 右键菜单：快速访问管理功能

---

这个插件大大简化了复杂工作流的节点管理，特别适合需要频繁调试和测试不同配置的场景。通过合理使用，可以显著提高工作效率。
