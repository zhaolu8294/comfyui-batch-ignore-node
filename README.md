# 批量忽略管理器 (Batch Ignore Manager)
[English README](https://github.com/zhaolu8294/comfyui-batch-ignore-node/blob/main/README_ENG.md)

一个用于 [ComfyUI](https://github.com/comfyanonymous/ComfyUI) 的高级节点管理插件，提供图形化界面批量控制节点的启用/忽略状态。

## 功能特性

### 🎯 核心功能
- **批量节点管理**: 通过单一控制节点管理多个节点的忽略状态
- **可视化控制界面**: 每个被管理节点都有独立的开关控件
- **全局主控开关**: 一键控制所有节点的启用/忽略状态
- **实时状态同步**: 自动检测并显示节点的当前状态

### 🛠️ 操作功能
- **添加选中节点**: 将当前选中的节点添加到管理器
- **刷新状态**: 重新同步所有节点的当前状态
- **全部启用**: 一键启用所有管理的节点
- **全部忽略**: 一键忽略所有管理的节点
- **清空列表**: 移除所有节点并恢复其状态

### 💾 持久化支持
- **工作流保存**: 管理器状态随工作流一起保存
- **自动恢复**: 加载工作流时自动恢复所有节点管理关系

## 安装方法

1. 将插件文件放置到 ComfyUI 的 `custom_nodes` 目录下
2. 重启 ComfyUI 或刷新节点列表
3. 在节点菜单的 "utils" 分类中找到 "批量忽略管理器" 节点

## 使用指南

### 基本使用

1. **创建管理器**: 从节点菜单添加 "批量忽略管理器" 节点
2. **添加节点**: 选中要管理的节点，点击管理器中的 "➕ 添加选中节点" 按钮
3. **控制状态**: 使用单个节点的开关或全局主控开关控制状态

### 控件说明

- **🎛️ 全部控制**: 主控开关，控制所有节点的整体状态
- **✅ 节点名 [YES]**: 单个节点开关（绿色表示启用状态）
- **⭕ 节点名 [NO]**: 单个节点开关（红色表示忽略状态）
- **🗑️ 移除**: 从管理器中移除该节点
- **操作按钮组**: 提供批量操作功能

### 状态指示

- **YES**: 节点处于启用状态（正常执行）
- **NO**: 节点处于忽略状态（绕过执行）
- **混合**: 节点状态不一致时的主控开关显示

## 技术实现

### 前端处理
所有节点控制逻辑在前端 JavaScript 中实现：
- 使用 `BYPASS_MODE = 4` 设置忽略状态
- 使用 `NORMAL_MODE = 0` 设置正常状态
- 实时更新节点外观和状态显示

### 后端框架
Python 端提供基本的节点框架：
- 定义节点输入输出类型
- 提供节点分类和元数据
- 确保与 ComfyUI 的兼容性

### 数据持久化
- 使用节点序列化保存管理节点列表
- 工作流加载时自动重建管理关系

## 注意事项

1. **不能管理自身**: 管理器无法将自己添加到管理列表中
2. **节点ID依赖**: 基于节点ID进行管理，复制节点时需要注意
3. **状态同步**: 手动修改节点状态后建议点击"刷新状态"按钮同步
4. **性能考虑**: 管理大量节点时界面可能会变长，建议分组使用

## 版本信息

- **当前版本**: v4.0 (逻辑优化版)
- **兼容性**: ComfyUI 最新版本
- **更新日期**: 2025-09-21

## 故障排除

### 常见问题

1. **节点状态不同步**: 点击"刷新状态"按钮
2. **找不到节点**: 节点可能已被删除，使用"清空列表"清理
3. **界面显示异常**: 调整管理器节点大小或刷新页面

### 日志查看
浏览器控制台会输出详细的操作日志，包括：
- 成功/失败的节点操作数量
- 未找到的节点ID列表
- 各种操作的执行结果

## 开发信息

### 文件结构
batch_ignore_manager/
├── init.py # 插件入口文件
├── batch_ignore_node.py # 节点类定义
└── web/
└── extensions.js # 前端逻辑实现
### 扩展API
插件使用 ComfyUI 的标准扩展机制：
- `app.registerExtension()` 注册扩展
- `beforeRegisterNodeDef` 修改节点行为
- 使用标准 widget 系统创建界面控件

## 支持与反馈
如有问题或建议，请提供以下信息：
1. ComfyUI 版本
2. 插件版本
3. 浏览器控制台错误信息
4. 重现问题的具体步骤

